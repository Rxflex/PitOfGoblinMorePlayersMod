name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout MorePlayers repository
      uses: actions/checkout@v4
      with:
        path: MorePlayers
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'
    
    - name: Build MorePlayers
      run: |
        cd MorePlayers
        dotnet build -c Release
    
    - name: Create release package
      run: |
        mkdir -p release/Mods
        
        # Copy MorePlayers.dll with error handling
        MOREDLL=$(find MorePlayers -name "MorePlayers.dll" -path "*/bin/Release/*" | head -1)
        [ -z "$MOREDLL" ] && echo "Error: MorePlayers.dll not found" && exit 1
        cp "$MOREDLL" release/Mods/
        
        # Copy documentation
        cp MorePlayers/README.md release/
        cp MorePlayers/QUICKSTART.md release/
        cp MorePlayers/CHANGELOG.md release/
        cp MorePlayers/LICENSE release/
        
        # Create installation instructions
        cat > release/INSTALL.txt << 'EOF'
        MorePlayers Mod Installation
        =============================
        
        1. Install MelonLoader to your Pit of Goblin game folder
           Download: https://github.com/LavaGang/MelonLoader/releases
        
        2. Copy MorePlayers.dll from the Mods folder to:
           <Game Folder>\Mods\
        
        3. Launch the game
        
        4. (Optional) Configure max players in:
           <Game Folder>\UserData\MelonPreferences.cfg
           
           [MorePlayers]
           MaxPlayers = 20
        
        For more information, see README.md
        EOF
    
    - name: Create zip archive
      run: |
        cd release
        zip -r ../MorePlayers-${{ github.ref_name }}.zip .
    
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v2
      with:
        files: MorePlayers-${{ github.ref_name }}.zip
        body: |
          ## MorePlayers Mod v${{ github.ref_name }}
          
          –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ Pit of Goblin —Å 4 –¥–æ 20 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è).
          
          ### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞
          
          1. –°–∫–∞—á–∞–π—Ç–µ `MorePlayers-${{ github.ref_name }}.zip`
          2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [MelonLoader](https://github.com/LavaGang/MelonLoader/releases) –≤ –ø–∞–ø–∫—É –∏–≥—Ä—ã
          3. –ò–∑–≤–ª–µ–∫–∏—Ç–µ `MorePlayers.dll` –∏–∑ –∞—Ä—Ö–∏–≤–∞ –≤ `<–ò–≥—Ä–∞>\Mods\`
          4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É
          
          ### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞
          
          –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏–º–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ **20 –∏–≥—Ä–æ–∫–æ–≤**.
          
          –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ 6, 8, 12):
          1. –û—Ç–∫—Ä–æ–π—Ç–µ `<–ò–≥—Ä–∞>\UserData\MelonPreferences.cfg`
          2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `[MorePlayers]`
          3. –ò–∑–º–µ–Ω–∏—Ç–µ `MaxPlayers = 20` –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          
          ### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
          
          - MelonLoader 0.6.1 –∏–ª–∏ –≤—ã—à–µ
          - Pit of Goblin (Steam –≤–µ—Ä—Å–∏—è)
          
          ### üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è
          
          –°–º. [CHANGELOG.md](https://github.com/Rxflex/MorePlayers/blob/main/CHANGELOG.md)
          
          ### ‚ö†Ô∏è –í–∞–∂–Ω–æ
          
          - –í—Å–µ –∏–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–æ–¥
          - –£ –≤—Å–µ—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ MaxPlayers
          
          ---
          
          **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [README.md](https://github.com/Rxflex/MorePlayers)
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
